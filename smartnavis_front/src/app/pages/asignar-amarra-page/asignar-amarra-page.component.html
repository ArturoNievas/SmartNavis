<app-app-page titulo="Asignar amarra">
  <div class="global-container local-container formContainer">
    <ng-container *ngIf="formularioActual === 'USUARIO'">
      <ng-container *ngTemplateOutlet="formularioSeleccionarUsuario">
      </ng-container>
    </ng-container>

    <ng-container *ngIf="formularioActual === 'EMBARCACION'">
      <ng-container *ngTemplateOutlet="formularioCargarEmbarcacion">
      </ng-container>
    </ng-container>

    <ng-container *ngIf="formularioActual === 'PROPIETARIO'">
      <ng-container *ngTemplateOutlet="formularioCargarPropietario">
      </ng-container>
    </ng-container>

    <ng-container *ngIf="formularioActual === 'AMARRA'">
      <ng-container *ngTemplateOutlet="formularioSeleccionarAmarra">
      </ng-container>
    </ng-container>

    <ng-container *ngTemplateOutlet="detalles"></ng-container>
  </div>
</app-app-page>

<ng-template #detalles>
  <div *ngIf="usuario?.value" class="details card">
    <div class="card-header">
      <h3>Detalles</h3>
    </div>

    <div class="card-body">
      <div *ngIf="usuario?.value" class="details-section">
        <div class="details-section-title">
          <h4 class="card-title">Usuario seleccionado:</h4>
        </div>

        <div class="card-body details-col">
          <span>
            <b>Nombre de usuario: </b>
            {{ usuario?.value?.username }}
          </span>

          <span>
            <b>Nombres: </b>
            {{ usuario?.value?.nombres }}
          </span>

          <span>
            <b>Apellidos: </b>
            {{ usuario?.value?.apellidos }}
          </span>

          <span>
            <b>DNI: </b>
            {{ usuario?.value?.dni }}
          </span>
        </div>
      </div>

      <div *ngIf="embarcacion?.value" class="details-section">
        <div class="details-section-title">
          <h4 class="card-title">Embarcación seleccionada:</h4>
        </div>

        <div class="card-body details-col">
          <span>
            <b>Nombre:</b>
            {{ embarcacion?.value?.nombre }}
          </span>

          <span>
            <b>Matrícula: </b>
            {{ embarcacion?.value?.matricula }}
          </span>

          <span>
            <b>Eslora: </b>
            {{ embarcacion?.value?.eslora }}
          </span>

          <span>
            <b>Manga: </b>
            {{ embarcacion?.value?.manga }}
          </span>

          <span>
            <b>Calado: </b>
            {{ embarcacion?.value?.calado }}
          </span>
        </div>
      </div>

      <div *ngIf="propietario?.value" class="details-section">
        <div class="details-section-title">
          <h4 class="card-title">Propietario de la embarcación:</h4>
        </div>
        <div class="card-body details-col">
          <span>
            <b>Nombres: </b>
            {{ usuario?.value?.nombres }}
          </span>

          <span>
            <b>Apellidos: </b>
            {{ usuario?.value?.apellidos }}
          </span>

          <span>
            <b>DNI: </b>
            {{ usuario?.value?.dni }}
          </span>
        </div>
      </div>

      <div *ngIf="amarra?.value" class="details-section">
        <div class="details-section-title">
          <h4 class="card-title">Amarra seleccionada:</h4>
        </div>
        <div class="details-col">
          <span>
            <b>Puerto: </b>
            <b>{{ amarra?.value?.puerto }}</b>
          </span>
          <span>
            <b>Nombre: </b>
            <b>{{ amarra?.value?.nombre }}</b>
          </span>
          <span>
            <b>Eslora: </b>
            <b>{{ amarra?.value?.eslora }}</b>
          </span>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #sinUsuarios>
  <div>
    <p class="alert alert-secondary">No hay usuarios.</p>
  </div>
</ng-template>

<ng-template #formularioSeleccionarUsuario>
  <div class="card">
    <div class="card-header">
      <h3>Seleccionar usuario (1/3)</h3>
    </div>

    <div class="card-body p-3">
      <form
        [formGroup]="buscarUsuariosPorDniForm"
        (keyup)="buscarUsuariosPorDni()"
      >
        <div class="form-group mb-3">
          <label class="w-100">
            <div>
              <div class="mb-2">Buscar usuario por DNI</div>
              <input
                type="number"
                class="form-control w-100"
                formControlName="dni"
                placeholder="DNI del usuario"
              />
            </div>
          </label>
        </div>
      </form>

      <div class="options">
        <form [formGroup]="asignarAmarraForm">
          <ol class="p-0 m-0" *ngIf="usuarios.length; else sinUsuarios">
            <div>
              <li *ngFor="let _usuario of usuarios">
                <div>
                  <span>
                    <b>{{ _usuario.nombres }} {{ _usuario.apellidos }}</b>
                  </span>

                  <button
                    class="btn btn-primary"
                    type="button"
                    (click)="seleccionarUsuario(_usuario)"
                  >
                    Seleccionar
                  </button>
                </div>
              </li>
            </div>
          </ol>
        </form>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #formularioCargarEmbarcacion>
  <div class="card">
    <div class="card-header">
      <h3>Cargar embarcación (2/3)</h3>
    </div>

    <div class="card-body p-3">
      <app-crear-embarcacion-form
        (enviarFormulario)="cargarEmbarcacion($event)"
      >
        <div class="form-check">
          <input id="esPropietario" type="checkbox" class="form-check-input" />
          <label class="form-check-label" for="esPropietario">
            ¿El usuario seleccionado es el propietario de la embarcación?
          </label>
        </div>
      </app-crear-embarcacion-form>
    </div>
  </div>
</ng-template>

<ng-template #formularioCargarPropietario>
  <div class="card">
    <div class="card-header">
      <h3>Seleccionar amarra (3/3)</h3>
    </div>

    <div class="card-body p-3">
      <form
        [formGroup]="buscarUsuariosPorDniForm"
        (keyup)="buscarUsuariosPorDni()"
      ></form>
    </div>
  </div>
</ng-template>

<ng-template #formularioSeleccionarAmarra>
  <div class="card">
    <div class="card-header">
      <h3>Seleccionar amarra (3/3)</h3>
    </div>

    <div class="card-body p-3">
      <form
        [formGroup]="buscarUsuariosPorDniForm"
        (keyup)="buscarUsuariosPorDni()"
      ></form>
    </div>
  </div>
</ng-template>
